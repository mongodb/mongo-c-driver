tasks:
  - name: abi-compliance-check
    commands:
      - func: abi-compliance-check
  - name: check-headers
    commands:
      - func: check-headers
  - name: make-release-archive
    commands:
      - func: release-archive
      - func: upload-docs
      - func: upload-man-pages
      - func: upload-build
      - func: upload-release
  - name: sasl-auto-darwinssl-macos-1014-clang-compile
    run_on: macos-1014
    tags: [sasl-matrix-darwinssl, compile, macos-1014, clang, sasl-auto]
    commands:
      - func: sasl-auto-darwinssl-compile
        vars:
          CC: clang
      - func: upload-build
  - name: sasl-auto-darwinssl-macos-1014-clang-test-3.6-server-auth
    run_on: macos-1014
    tags: [sasl-matrix-darwinssl, test, macos-1014, clang, sasl-auto, auth, server, "3.6"]
    depends_on: [{ name: sasl-auto-darwinssl-macos-1014-clang-compile }]
    commands:
      - func: fetch-build
        vars:
          BUILD_NAME: sasl-auto-darwinssl-macos-1014-clang-compile
      - command: expansions.update
        params:
          updates:
            - { key: CC, value: clang }
            - { key: AUTH, value: auth }
            - { key: MONGODB_VERSION, value: "3.6" }
            - { key: TOPOLOGY, value: server }
            - { key: SSL, value: darwinssl }
      - func: fetch-det
      - func: bootstrap-mongo-orchestration
      - func: run-tests
  - name: sasl-auto-darwinssl-macos-1014-clang-test-3.6-server-noauth
    run_on: macos-1014
    tags: [sasl-matrix-darwinssl, test, macos-1014, clang, sasl-auto, noauth, server, "3.6"]
    depends_on: [{ name: sasl-auto-darwinssl-macos-1014-clang-compile }]
    commands:
      - func: fetch-build
        vars:
          BUILD_NAME: sasl-auto-darwinssl-macos-1014-clang-compile
      - command: expansions.update
        params:
          updates:
            - { key: CC, value: clang }
            - { key: AUTH, value: noauth }
            - { key: MONGODB_VERSION, value: "3.6" }
            - { key: TOPOLOGY, value: server }
            - { key: SSL, value: darwinssl }
      - func: fetch-det
      - func: bootstrap-mongo-orchestration
      - func: run-tests
  - name: sasl-auto-darwinssl-macos-1014-clang-test-4.0-server-auth
    run_on: macos-1014
    tags: [sasl-matrix-darwinssl, test, macos-1014, clang, sasl-auto, auth, server, "4.0"]
    depends_on: [{ name: sasl-auto-darwinssl-macos-1014-clang-compile }]
    commands:
      - func: fetch-build
        vars:
          BUILD_NAME: sasl-auto-darwinssl-macos-1014-clang-compile
      - command: expansions.update
        params:
          updates:
            - { key: CC, value: clang }
            - { key: AUTH, value: auth }
            - { key: MONGODB_VERSION, value: "4.0" }
            - { key: TOPOLOGY, value: server }
            - { key: SSL, value: darwinssl }
      - func: fetch-det
      - func: bootstrap-mongo-orchestration
      - func: run-tests
  - name: sasl-auto-darwinssl-macos-1014-clang-test-4.0-server-noauth
    run_on: macos-1014
    tags: [sasl-matrix-darwinssl, test, macos-1014, clang, sasl-auto, noauth, server, "4.0"]
    depends_on: [{ name: sasl-auto-darwinssl-macos-1014-clang-compile }]
    commands:
      - func: fetch-build
        vars:
          BUILD_NAME: sasl-auto-darwinssl-macos-1014-clang-compile
      - command: expansions.update
        params:
          updates:
            - { key: CC, value: clang }
            - { key: AUTH, value: noauth }
            - { key: MONGODB_VERSION, value: "4.0" }
            - { key: TOPOLOGY, value: server }
            - { key: SSL, value: darwinssl }
      - func: fetch-det
      - func: bootstrap-mongo-orchestration
      - func: run-tests
  - name: sasl-auto-darwinssl-macos-1014-clang-test-4.2-server-auth
    run_on: macos-1014
    tags: [sasl-matrix-darwinssl, test, macos-1014, clang, sasl-auto, auth, server, "4.2"]
    depends_on: [{ name: sasl-auto-darwinssl-macos-1014-clang-compile }]
    commands:
      - func: fetch-build
        vars:
          BUILD_NAME: sasl-auto-darwinssl-macos-1014-clang-compile
      - command: expansions.update
        params:
          updates:
            - { key: CC, value: clang }
            - { key: AUTH, value: auth }
            - { key: MONGODB_VERSION, value: "4.2" }
            - { key: TOPOLOGY, value: server }
            - { key: SSL, value: darwinssl }
      - func: fetch-det
      - func: bootstrap-mongo-orchestration
      - func: run-tests
  - name: sasl-auto-darwinssl-macos-1014-clang-test-4.2-server-noauth
    run_on: macos-1014
    tags: [sasl-matrix-darwinssl, test, macos-1014, clang, sasl-auto, noauth, server, "4.2"]
    depends_on: [{ name: sasl-auto-darwinssl-macos-1014-clang-compile }]
    commands:
      - func: fetch-build
        vars:
          BUILD_NAME: sasl-auto-darwinssl-macos-1014-clang-compile
      - command: expansions.update
        params:
          updates:
            - { key: CC, value: clang }
            - { key: AUTH, value: noauth }
            - { key: MONGODB_VERSION, value: "4.2" }
            - { key: TOPOLOGY, value: server }
            - { key: SSL, value: darwinssl }
      - func: fetch-det
      - func: bootstrap-mongo-orchestration
      - func: run-tests
  - name: sasl-auto-darwinssl-macos-1014-clang-test-4.4-server-auth
    run_on: macos-1014
    tags: [sasl-matrix-darwinssl, test, macos-1014, clang, sasl-auto, auth, server, "4.4"]
    depends_on: [{ name: sasl-auto-darwinssl-macos-1014-clang-compile }]
    commands:
      - func: fetch-build
        vars:
          BUILD_NAME: sasl-auto-darwinssl-macos-1014-clang-compile
      - command: expansions.update
        params:
          updates:
            - { key: CC, value: clang }
            - { key: AUTH, value: auth }
            - { key: MONGODB_VERSION, value: "4.4" }
            - { key: TOPOLOGY, value: server }
            - { key: SSL, value: darwinssl }
      - func: fetch-det
      - func: bootstrap-mongo-orchestration
      - func: run-tests
  - name: sasl-auto-darwinssl-macos-1014-clang-test-4.4-server-noauth
    run_on: macos-1014
    tags: [sasl-matrix-darwinssl, test, macos-1014, clang, sasl-auto, noauth, server, "4.4"]
    depends_on: [{ name: sasl-auto-darwinssl-macos-1014-clang-compile }]
    commands:
      - func: fetch-build
        vars:
          BUILD_NAME: sasl-auto-darwinssl-macos-1014-clang-compile
      - command: expansions.update
        params:
          updates:
            - { key: CC, value: clang }
            - { key: AUTH, value: noauth }
            - { key: MONGODB_VERSION, value: "4.4" }
            - { key: TOPOLOGY, value: server }
            - { key: SSL, value: darwinssl }
      - func: fetch-det
      - func: bootstrap-mongo-orchestration
      - func: run-tests
  - name: sasl-auto-darwinssl-macos-1014-clang-test-5.0-server-auth
    run_on: macos-1014
    tags: [sasl-matrix-darwinssl, test, macos-1014, clang, sasl-auto, auth, server, "5.0"]
    depends_on: [{ name: sasl-auto-darwinssl-macos-1014-clang-compile }]
    commands:
      - func: fetch-build
        vars:
          BUILD_NAME: sasl-auto-darwinssl-macos-1014-clang-compile
      - command: expansions.update
        params:
          updates:
            - { key: CC, value: clang }
            - { key: AUTH, value: auth }
            - { key: MONGODB_VERSION, value: "5.0" }
            - { key: TOPOLOGY, value: server }
            - { key: SSL, value: darwinssl }
      - func: fetch-det
      - func: bootstrap-mongo-orchestration
      - func: run-tests
  - name: sasl-auto-darwinssl-macos-1014-clang-test-5.0-server-noauth
    run_on: macos-1014
    tags: [sasl-matrix-darwinssl, test, macos-1014, clang, sasl-auto, noauth, server, "5.0"]
    depends_on: [{ name: sasl-auto-darwinssl-macos-1014-clang-compile }]
    commands:
      - func: fetch-build
        vars:
          BUILD_NAME: sasl-auto-darwinssl-macos-1014-clang-compile
      - command: expansions.update
        params:
          updates:
            - { key: CC, value: clang }
            - { key: AUTH, value: noauth }
            - { key: MONGODB_VERSION, value: "5.0" }
            - { key: TOPOLOGY, value: server }
            - { key: SSL, value: darwinssl }
      - func: fetch-det
      - func: bootstrap-mongo-orchestration
      - func: run-tests
  - name: sasl-auto-darwinssl-macos-1014-clang-test-latest-server-auth
    run_on: macos-1014
    tags: [sasl-matrix-darwinssl, test, macos-1014, clang, sasl-auto, auth, server, latest]
    depends_on: [{ name: sasl-auto-darwinssl-macos-1014-clang-compile }]
    commands:
      - func: fetch-build
        vars:
          BUILD_NAME: sasl-auto-darwinssl-macos-1014-clang-compile
      - command: expansions.update
        params:
          updates:
            - { key: CC, value: clang }
            - { key: AUTH, value: auth }
            - { key: MONGODB_VERSION, value: latest }
            - { key: TOPOLOGY, value: server }
            - { key: SSL, value: darwinssl }
      - func: fetch-det
      - func: bootstrap-mongo-orchestration
      - func: run-tests
  - name: sasl-auto-darwinssl-macos-1014-clang-test-latest-server-noauth
    run_on: macos-1014
    tags: [sasl-matrix-darwinssl, test, macos-1014, clang, sasl-auto, noauth, server, latest]
    depends_on: [{ name: sasl-auto-darwinssl-macos-1014-clang-compile }]
    commands:
      - func: fetch-build
        vars:
          BUILD_NAME: sasl-auto-darwinssl-macos-1014-clang-compile
      - command: expansions.update
        params:
          updates:
            - { key: CC, value: clang }
            - { key: AUTH, value: noauth }
            - { key: MONGODB_VERSION, value: latest }
            - { key: TOPOLOGY, value: server }
            - { key: SSL, value: darwinssl }
      - func: fetch-det
      - func: bootstrap-mongo-orchestration
      - func: run-tests
