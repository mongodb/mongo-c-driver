<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml" lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>mongoc_collection_count_with_opts() &#8212; MongoDB C Driver 1.6.3</title>
    
    <link rel="stylesheet" href="_static/mongoc.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '1.6.3',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  false,
        SOURCELINK_SUFFIX: '.txt'
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="mongoc_collection_create_bulk_operation()" href="mongoc_collection_create_bulk_operation.html" />
    <link rel="prev" title="mongoc_collection_count()" href="mongoc_collection_count.html" />
   
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9">

  </head>
  <body role="document">  

    <div class="document">
  <div class="documentwrapper">
    <div class="bodywrapper" id="mongoc_collection_count_with_opts">
      <div class="body" role="main">
        
            <div class="related">
              <ul>
                <li class="nav-item nav-item-0"><a href="index.html">MongoDB C Driver 1.6.3</a> &#187;</li>
                
                  <li class="nav-item nav-item-1"><a href="api.html">API Reference</a> &#187;</li>
                
                  <li class="nav-item nav-item-2"><a href="mongoc_collection_t.html">mongoc_collection_t</a></li>
                
              </ul>
            </div>
          
        
  <div class="section" id="mongoc-collection-count-with-opts">
<h1>mongoc_collection_count_with_opts()<a class="headerlink" href="#mongoc-collection-count-with-opts" title="Permalink to this headline">¶</a></h1>
<div class="section" id="synopsis">
<h2>Synopsis<a class="headerlink" href="#synopsis" title="Permalink to this headline">¶</a></h2>
<div class="highlight-c"><div class="highlight"><pre><span class="kt">int64_t</span>
<span class="nf">mongoc_collection_count_with_opts</span> <span class="p">(</span><span class="n">mongoc_collection_t</span> <span class="o">*</span><span class="n">collection</span><span class="p">,</span>
                                   <span class="n">mongoc_query_flags_t</span> <span class="n">flags</span><span class="p">,</span>
                                   <span class="k">const</span> <span class="n">bson_t</span> <span class="o">*</span><span class="n">query</span><span class="p">,</span>
                                   <span class="kt">int64_t</span> <span class="n">skip</span><span class="p">,</span>
                                   <span class="kt">int64_t</span> <span class="n">limit</span><span class="p">,</span>
                                   <span class="k">const</span> <span class="n">bson_t</span> <span class="o">*</span><span class="n">opts</span><span class="p">,</span>
                                   <span class="k">const</span> <span class="n">mongoc_read_prefs_t</span> <span class="o">*</span><span class="n">read_prefs</span><span class="p">,</span>
                                   <span class="n">bson_error_t</span> <span class="o">*</span><span class="n">error</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="section" id="parameters">
<h2>Parameters<a class="headerlink" href="#parameters" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">collection</span></code>: A <a class="symbol reference internal" href="mongoc_collection_t.html"><span class="doc">mongoc_collection_t</span></a>.</li>
<li><code class="docutils literal"><span class="pre">flags</span></code>: A <a class="symbol reference internal" href="mongoc_query_flags_t.html"><span class="doc">mongoc_query_flags_t</span></a>.</li>
<li><code class="docutils literal"><span class="pre">query</span></code>: A <a class="symbol reference external" href="http://mongoc.org/libbson/current/bson_t.html" title="(in Libbson v1.6.2)"><code class="xref symbol docutils literal"><span class="pre">bson_t</span></code></a> containing the query.</li>
<li><code class="docutils literal"><span class="pre">skip</span></code>: A int64_t, zero to ignore.</li>
<li><code class="docutils literal"><span class="pre">limit</span></code>: A int64_t, zero to ignore.</li>
<li><code class="docutils literal"><span class="pre">opts</span></code>: A <a class="symbol reference external" href="http://mongoc.org/libbson/current/bson_t.html" title="(in Libbson v1.6.2)"><code class="xref symbol docutils literal"><span class="pre">bson_t</span></code></a>, <code class="docutils literal"><span class="pre">NULL</span></code> to ignore.</li>
<li><code class="docutils literal"><span class="pre">read_prefs</span></code>: An optional <a class="symbol reference internal" href="mongoc_read_prefs_t.html"><span class="doc">mongoc_read_prefs_t</span></a>, otherwise uses the collection's read preference.</li>
<li><code class="docutils literal"><span class="pre">error</span></code>: An optional location for a <a class="symbol reference internal" href="errors.html"><span class="doc">bson_error_t</span></a> or <code class="docutils literal"><span class="pre">NULL</span></code>.</li>
</ul>
</div>
<div class="section" id="description">
<h2>Description<a class="headerlink" href="#description" title="Permalink to this headline">¶</a></h2>
<p>This function shall execute a count query on the underlying 'collection'. The bson 'query' is not validated, simply passed along as appropriate to the server.  As such, compatibility and errors should be validated in the appropriate server documentation.</p>
<p>The <a class="symbol reference internal" href="mongoc_read_concern_t.html"><span class="doc">mongoc_read_concern_t</span></a> specified on the <a class="symbol reference internal" href="mongoc_collection_t.html"><span class="doc">mongoc_collection_t</span></a> will be used, if any. If <code class="docutils literal"><span class="pre">read_prefs</span></code> is NULL, the collection's read preferences are used.</p>
<p>In addition to the standard functionality available from mongoc_collection_count, this function allows the user to add arbitrary extra keys to the count.  This pass through enables features such as hinting for counts.</p>
<p>For more information, see the <a class="reference external" href="http://docs.mongodb.org/manual/reference/operator/query/">query reference</a> at the MongoDB website.</p>
</div>
<div class="section" id="errors">
<h2>Errors<a class="headerlink" href="#errors" title="Permalink to this headline">¶</a></h2>
<p>Errors are propagated via the <code class="docutils literal"><span class="pre">error</span></code> parameter.</p>
</div>
<div class="section" id="returns">
<h2>Returns<a class="headerlink" href="#returns" title="Permalink to this headline">¶</a></h2>
<p>-1 on failure, otherwise the number of documents counted.</p>
</div>
<div class="section" id="examples">
<h2>Examples<a class="headerlink" href="#examples" title="Permalink to this headline">¶</a></h2>
<div class="literal-block-wrapper container" id="id1">
<div class="code-block-caption"><span class="caption-text">Basic Counting</span><a class="headerlink" href="#id1" title="Permalink to this code">¶</a></div>
<div class="highlight-c"><div class="highlight"><pre><span class="cp">#include</span> <span class="cpf">&lt;mongoc.h&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;bcon.h&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;stdio.h&gt;</span><span class="cp"></span>

<span class="k">static</span> <span class="kt">void</span>
<span class="nf">print_query_count</span> <span class="p">(</span><span class="n">mongoc_collection_t</span> <span class="o">*</span><span class="n">collection</span><span class="p">,</span> <span class="n">bson_t</span> <span class="o">*</span><span class="n">query</span><span class="p">)</span>
<span class="p">{</span>
   <span class="n">bson_error_t</span> <span class="n">error</span><span class="p">;</span>
   <span class="kt">int64_t</span> <span class="n">count</span><span class="p">;</span>
   <span class="n">bson_t</span> <span class="n">opts</span><span class="p">;</span>

   <span class="n">bson_init</span> <span class="p">(</span><span class="o">&amp;</span><span class="n">opts</span><span class="p">);</span>
   <span class="n">BSON_APPEND_UTF8</span> <span class="p">(</span><span class="o">&amp;</span><span class="n">opts</span><span class="p">,</span> <span class="s">&quot;hint&quot;</span><span class="p">,</span> <span class="s">&quot;_id_&quot;</span><span class="p">);</span>

   <span class="n">count</span> <span class="o">=</span> <span class="n">mongoc_collection_count_with_opts</span> <span class="p">(</span>
      <span class="n">collection</span><span class="p">,</span> <span class="n">MONGOC_QUERY_NONE</span><span class="p">,</span> <span class="n">query</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">opts</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">error</span><span class="p">);</span>

   <span class="n">bson_destroy</span> <span class="p">(</span><span class="o">&amp;</span><span class="n">opts</span><span class="p">);</span>

   <span class="k">if</span> <span class="p">(</span><span class="n">count</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">fprintf</span> <span class="p">(</span><span class="n">stderr</span><span class="p">,</span> <span class="s">&quot;Count failed: %s</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">error</span><span class="p">.</span><span class="n">message</span><span class="p">);</span>
   <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
      <span class="n">printf</span> <span class="p">(</span><span class="s">&quot;%&quot;</span> <span class="n">PRId64</span> <span class="s">&quot; documents counted.</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">count</span><span class="p">);</span>
   <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="literal-block-wrapper container" id="id2">
<div class="code-block-caption"><span class="caption-text">Counting with Collation</span><a class="headerlink" href="#id2" title="Permalink to this code">¶</a></div>
<div class="highlight-c"><div class="highlight"><pre><span class="cp">#include</span> <span class="cpf">&lt;mongoc.h&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;bcon.h&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;stdio.h&gt;</span><span class="cp"></span>

<span class="k">static</span> <span class="kt">void</span>
<span class="nf">print_query_count</span> <span class="p">(</span><span class="n">mongoc_collection_t</span> <span class="o">*</span><span class="n">collection</span><span class="p">,</span> <span class="n">bson_t</span> <span class="o">*</span><span class="n">query</span><span class="p">)</span>
<span class="p">{</span>
   <span class="n">bson_t</span> <span class="o">*</span><span class="n">selector</span><span class="p">;</span>
   <span class="n">bson_t</span> <span class="o">*</span><span class="n">opts</span><span class="p">;</span>
   <span class="n">bson_error_t</span> <span class="n">error</span><span class="p">;</span>
   <span class="kt">int64_t</span> <span class="n">count</span><span class="p">;</span>

   <span class="n">selector</span> <span class="o">=</span> <span class="n">BCON_NEW</span> <span class="p">(</span><span class="s">&quot;_id&quot;</span><span class="p">,</span> <span class="s">&quot;{&quot;</span><span class="p">,</span> <span class="s">&quot;$gt&quot;</span><span class="p">,</span> <span class="n">BCON_UTF8</span> <span class="p">(</span><span class="s">&quot;one&quot;</span><span class="p">),</span> <span class="s">&quot;}&quot;</span><span class="p">);</span>

   <span class="cm">/* &quot;One&quot; normally sorts before &quot;one&quot;; make &quot;one&quot; come first */</span>
   <span class="n">opts</span> <span class="o">=</span> <span class="n">BCON_NEW</span> <span class="p">(</span><span class="s">&quot;collation&quot;</span><span class="p">,</span>
                    <span class="s">&quot;{&quot;</span><span class="p">,</span>
                    <span class="s">&quot;locale&quot;</span><span class="p">,</span>
                    <span class="n">BCON_UTF8</span> <span class="p">(</span><span class="s">&quot;en_US&quot;</span><span class="p">),</span>
                    <span class="s">&quot;caseFirst&quot;</span><span class="p">,</span>
                    <span class="n">BCON_UTF8</span> <span class="p">(</span><span class="s">&quot;lower&quot;</span><span class="p">),</span>
                    <span class="s">&quot;}&quot;</span><span class="p">);</span>

   <span class="n">count</span> <span class="o">=</span> <span class="n">mongoc_collection_count_with_opts</span> <span class="p">(</span>
      <span class="n">collection</span><span class="p">,</span> <span class="n">MONGOC_QUERY_NONE</span><span class="p">,</span> <span class="n">query</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">opts</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">error</span><span class="p">);</span>

   <span class="n">bson_destroy</span> <span class="p">(</span><span class="n">selector</span><span class="p">);</span>
   <span class="n">bson_destroy</span> <span class="p">(</span><span class="n">opts</span><span class="p">);</span>

   <span class="k">if</span> <span class="p">(</span><span class="n">count</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">fprintf</span> <span class="p">(</span><span class="n">stderr</span><span class="p">,</span> <span class="s">&quot;Count failed: %s</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">error</span><span class="p">.</span><span class="n">message</span><span class="p">);</span>
   <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
      <span class="n">printf</span> <span class="p">(</span><span class="s">&quot;%&quot;</span> <span class="n">PRId64</span> <span class="s">&quot; documents counted.</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">count</span><span class="p">);</span>
   <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
</div>
</div>


      </div>
      <div class="footer">
        <div class="footer-nav">
          <a class="footer-nav-button footer-nav-button-prev" title="mongoc_collection_count()" href="mongoc_collection_count.html">&laquo; Previous: mongoc_collection_count()</a>
          <a class="footer-nav-button footer-nav-button-next" title="mongoc_collection_create_bulk_operation()" href="mongoc_collection_create_bulk_operation.html">Next: mongoc_collection_create_bulk_operation() &raquo;</a>
        </div>
      </div>
    </div>
  </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper"><h3><a href="index.html">MongoDB C Driver 1.6.3</a></h3>
<ul>
<li class="toctree-l1"><a class="reference internal" href="installing.html">Installing the MongoDB C Driver</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="tutorial.html">Tutorial</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="authentication.html">Authentication</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="basic-troubleshooting.html">Basic Troubleshooting</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="guides.html">Guides</a></li>
</ul>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="api.html">API Reference</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="init-cleanup.html">Initialization and cleanup</a></li>
<li class="toctree-l2"><a class="reference internal" href="logging.html">Logging</a></li>
<li class="toctree-l2"><a class="reference internal" href="errors.html">Error Reporting</a></li>
<li class="toctree-l2"><a class="reference internal" href="mongoc_version.html">Version Checks</a></li>
<li class="toctree-l2"><a class="reference internal" href="mongoc_bulk_operation_t.html">mongoc_bulk_operation_t</a></li>
<li class="toctree-l2"><a class="reference internal" href="mongoc_client_pool_t.html">mongoc_client_pool_t</a></li>
<li class="toctree-l2"><a class="reference internal" href="mongoc_client_t.html">mongoc_client_t</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="mongoc_collection_t.html">mongoc_collection_t</a></li>
<li class="toctree-l2"><a class="reference internal" href="mongoc_cursor_t.html">mongoc_cursor_t</a></li>
<li class="toctree-l2"><a class="reference internal" href="mongoc_database_t.html">mongoc_database_t</a></li>
<li class="toctree-l2"><a class="reference internal" href="mongoc_delete_flags_t.html">mongoc_delete_flags_t</a></li>
<li class="toctree-l2"><a class="reference internal" href="mongoc_find_and_modify_opts_t.html">mongoc_find_and_modify_opts_t</a></li>
<li class="toctree-l2"><a class="reference internal" href="mongoc_gridfs_file_list_t.html">mongoc_gridfs_file_list_t</a></li>
<li class="toctree-l2"><a class="reference internal" href="mongoc_gridfs_file_opt_t.html">mongoc_gridfs_file_opt_t</a></li>
<li class="toctree-l2"><a class="reference internal" href="mongoc_gridfs_file_t.html">mongoc_gridfs_file_t</a></li>
<li class="toctree-l2"><a class="reference internal" href="mongoc_gridfs_t.html">mongoc_gridfs_t</a></li>
<li class="toctree-l2"><a class="reference internal" href="mongoc_host_list_t.html">mongoc_host_list_t</a></li>
<li class="toctree-l2"><a class="reference internal" href="mongoc_index_opt_geo_t.html">mongoc_index_opt_geo_t</a></li>
<li class="toctree-l2"><a class="reference internal" href="mongoc_index_opt_t.html">mongoc_index_opt_t</a></li>
<li class="toctree-l2"><a class="reference internal" href="mongoc_index_opt_wt_t.html">mongoc_index_opt_wt_t</a></li>
<li class="toctree-l2"><a class="reference internal" href="mongoc_insert_flags_t.html">mongoc_insert_flags_t</a></li>
<li class="toctree-l2"><a class="reference internal" href="mongoc_iovec_t.html">mongoc_iovec_t</a></li>
<li class="toctree-l2"><a class="reference internal" href="mongoc_matcher_t.html">mongoc_matcher_t</a></li>
<li class="toctree-l2"><a class="reference internal" href="mongoc_query_flags_t.html">mongoc_query_flags_t</a></li>
<li class="toctree-l2"><a class="reference internal" href="mongoc_rand.html">mongoc_rand</a></li>
<li class="toctree-l2"><a class="reference internal" href="mongoc_read_concern_t.html">mongoc_read_concern_t</a></li>
<li class="toctree-l2"><a class="reference internal" href="mongoc_read_mode_t.html">mongoc_read_mode_t</a></li>
<li class="toctree-l2"><a class="reference internal" href="mongoc_read_prefs_t.html">mongoc_read_prefs_t</a></li>
<li class="toctree-l2"><a class="reference internal" href="mongoc_remove_flags_t.html">mongoc_remove_flags_t</a></li>
<li class="toctree-l2"><a class="reference internal" href="mongoc_reply_flags_t.html">mongoc_reply_flags_t</a></li>
<li class="toctree-l2"><a class="reference internal" href="mongoc_server_description_t.html">mongoc_server_description_t</a></li>
<li class="toctree-l2"><a class="reference internal" href="mongoc_socket_t.html">mongoc_socket_t</a></li>
<li class="toctree-l2"><a class="reference internal" href="mongoc_ssl_opt_t.html">mongoc_ssl_opt_t</a></li>
<li class="toctree-l2"><a class="reference internal" href="mongoc_stream_buffered_t.html">mongoc_stream_buffered_t</a></li>
<li class="toctree-l2"><a class="reference internal" href="mongoc_stream_file_t.html">mongoc_stream_file_t</a></li>
<li class="toctree-l2"><a class="reference internal" href="mongoc_stream_gridfs_t.html">mongoc_stream_gridfs_t</a></li>
<li class="toctree-l2"><a class="reference internal" href="mongoc_stream_socket_t.html">mongoc_stream_socket_t</a></li>
<li class="toctree-l2"><a class="reference internal" href="mongoc_stream_t.html">mongoc_stream_t</a></li>
<li class="toctree-l2"><a class="reference internal" href="mongoc_stream_tls_t.html">mongoc_stream_tls_t</a></li>
<li class="toctree-l2"><a class="reference internal" href="mongoc_topology_description_t.html">mongoc_topology_description_t</a></li>
<li class="toctree-l2"><a class="reference internal" href="mongoc_update_flags_t.html">mongoc_update_flags_t</a></li>
<li class="toctree-l2"><a class="reference internal" href="mongoc_uri_t.html">mongoc_uri_t</a></li>
<li class="toctree-l2"><a class="reference internal" href="mongoc_write_concern_t.html">mongoc_write_concern_t</a></li>
</ul>
</li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="application-performance-monitoring.html">Application Performance Monitoring (APM)</a></li>
</ul>

<ul>
  <li class="toctree-l1 ">
    <a href="full_index.html">Index</a>
  </li>
</ul>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
  <div class="colophon">
    Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.5.3, based on <a href="https://sphinx-readable-theme.readthedocs.io/en/latest/">Sphinx Readable Theme</a>.
  </div>

  </body>
</html>