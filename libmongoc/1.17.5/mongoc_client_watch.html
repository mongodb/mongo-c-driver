
<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml" lang="en">
  <head>
    <meta charset="utf-8" />
<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-7301842-14"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-7301842-14');
</script>
<link rel="canonical" href="http://mongoc.org/libbson/current/mongoc_client_watch.html"/>
    <title>mongoc_client_watch() &#8212; libmongoc 1.17.5</title>
    <link rel="stylesheet" href="_static/readable.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="mongoc_database_watch()" href="mongoc_database_watch.html" />
    <link rel="prev" title="mongoc_change_stream_t" href="mongoc_change_stream_t.html" />
   
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9">

  </head><body>
<div style="text-align: center; border: 1px solid gray; padding: 10px; background: #d4f1ff">
  This is an outdated version of the documentation.
  <a href="http://mongoc.org/libmongoc/current/mongoc_client_watch.html" 
     style="color: black; font-weight: bold; text-decoration: underline;">
    See the current version of this page</a>.
</div>
  
  

    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="mongoc_database_watch.html" title="mongoc_database_watch()"
             accesskey="N">next</a></li>
        <li class="right" >
          <a href="mongoc_change_stream_t.html" title="mongoc_change_stream_t"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">libmongoc 1.17.5</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="api.html" >API Reference</a> &#187;</li>
          <li class="nav-item nav-item-2"><a href="mongoc_change_stream_t.html" accesskey="U">mongoc_change_stream_t</a> &#187;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="mongoc-client-watch">
<h1>mongoc_client_watch()<a class="headerlink" href="#mongoc-client-watch" title="Permalink to this headline">¶</a></h1>
<div class="section" id="synopsis">
<h2>Synopsis<a class="headerlink" href="#synopsis" title="Permalink to this headline">¶</a></h2>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="n">mongoc_change_stream_t</span><span class="o">*</span>
<span class="nf">mongoc_client_watch</span> <span class="p">(</span><span class="n">mongoc_client_t</span> <span class="o">*</span><span class="n">client</span><span class="p">,</span>
                     <span class="k">const</span> <span class="n">bson_t</span> <span class="o">*</span><span class="n">pipeline</span><span class="p">,</span>
                     <span class="k">const</span> <span class="n">bson_t</span> <span class="o">*</span><span class="n">opts</span><span class="p">);</span>
</pre></div>
</div>
<p>A helper function to create a change stream. It is preferred to call this
function over using a raw aggregation to create a change stream.</p>
<p>This function uses the read preference and read concern of the client. If
the change stream needs to re-establish connection, the same read preference
will be used. This may happen if the change stream encounters a resumable error.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>A change stream is only supported with majority read concern.</p>
</div>
<p>This function is considered a retryable read operation.
Upon a transient error (a network error, errors due to replica set failover, etc.) the operation is safely retried once.
If <code class="docutils literal notranslate"><span class="pre">retryreads</span></code> is false in the URI (see <a class="symbol reference internal" href="mongoc_uri_t.html"><span class="doc">mongoc_uri_t</span></a>) the retry behavior does not apply.</p>
</div>
<div class="section" id="parameters">
<h2>Parameters<a class="headerlink" href="#parameters" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">db</span></code>: A <a class="symbol reference internal" href="mongoc_client_t.html"><span class="doc">mongoc_client_t</span></a> specifying the client which the change stream listens to.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">pipeline</span></code>: A <a class="symbol reference external" href="http://mongoc.org/libbson/current/bson_t.html" title="(in libbson v1.17.5)"><code class="xref symbol docutils literal notranslate"><span class="pre">bson_t</span></code></a> representing an aggregation pipeline appended to the change stream. This may be an empty document.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">opts</span></code>: A <a class="symbol reference external" href="http://mongoc.org/libbson/current/bson_t.html" title="(in libbson v1.17.5)"><code class="xref symbol docutils literal notranslate"><span class="pre">bson_t</span></code></a> containing change stream options.</p></li>
</ul>
<p><code class="docutils literal notranslate"><span class="pre">opts</span></code> may be NULL or a BSON document with additional command options:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">batchSize</span></code>: An <code class="docutils literal notranslate"><span class="pre">int32</span></code> representing number of documents requested to be returned on each call to <a class="symbol reference internal" href="mongoc_change_stream_next.html"><span class="doc">mongoc_change_stream_next()</span></a></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">resumeAfter</span></code>: A <code class="docutils literal notranslate"><span class="pre">Document</span></code> representing the logical starting point of the change stream. The result of <a class="symbol reference internal" href="mongoc_change_stream_get_resume_token.html"><span class="doc">mongoc_change_stream_get_resume_token()</span></a> or the <code class="docutils literal notranslate"><span class="pre">_id</span></code> field  of any change received from a change stream can be used here. This option is mutually exclusive with <code class="docutils literal notranslate"><span class="pre">startAfter</span></code> and <code class="docutils literal notranslate"><span class="pre">startAtOperationTime</span></code>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">startAfter</span></code>: A <code class="docutils literal notranslate"><span class="pre">Document</span></code> representing the logical starting point of the change stream. Unlike <code class="docutils literal notranslate"><span class="pre">resumeAfter</span></code>, this can resume notifications after an “invalidate” event. The result of <a class="symbol reference internal" href="mongoc_change_stream_get_resume_token.html"><span class="doc">mongoc_change_stream_get_resume_token()</span></a> or the <code class="docutils literal notranslate"><span class="pre">_id</span></code> field  of any change received from a change stream can be used here.  This option is mutually exclusive with <code class="docutils literal notranslate"><span class="pre">resumeAfter</span></code> and <code class="docutils literal notranslate"><span class="pre">startAtOperationTime</span></code>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">startAtOperationTime</span></code>: A <code class="docutils literal notranslate"><span class="pre">Timestamp</span></code>. The change stream only provides changes that occurred at or after the specified timestamp. Any command run against the server will return an operation time that can be used here. This option is mutually exclusive with <code class="docutils literal notranslate"><span class="pre">resumeAfter</span></code> and <code class="docutils literal notranslate"><span class="pre">startAfter</span></code>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">maxAwaitTimeMS</span></code>: An <code class="docutils literal notranslate"><span class="pre">int64</span></code> representing the maximum amount of time a call to <a class="symbol reference internal" href="mongoc_change_stream_next.html"><span class="doc">mongoc_change_stream_next()</span></a> will block waiting for data</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">fullDocument</span></code>: A UTF-8 string. Set this option to “updateLookup” to direct the change stream cursor to lookup the most current majority-committed version of the document associated to an update change stream event.</p></li>
</ul>
</div>
<div class="section" id="returns">
<h2>Returns<a class="headerlink" href="#returns" title="Permalink to this headline">¶</a></h2>
<p>A newly allocated <a class="symbol reference internal" href="mongoc_change_stream_t.html"><span class="doc">mongoc_change_stream_t</span></a> which must be freed with
<a class="symbol reference internal" href="mongoc_change_stream_destroy.html"><span class="doc">mongoc_change_stream_destroy()</span></a> when no longer in use. The returned
<a class="symbol reference internal" href="mongoc_change_stream_t.html"><span class="doc">mongoc_change_stream_t</span></a> is never <code class="docutils literal notranslate"><span class="pre">NULL</span></code>. If there is an error, it can
be retrieved with <a class="symbol reference internal" href="mongoc_change_stream_error_document.html"><span class="doc">mongoc_change_stream_error_document()</span></a>, and subsequent
calls to <a class="symbol reference internal" href="mongoc_change_stream_next.html"><span class="doc">mongoc_change_stream_next()</span></a> will return <code class="docutils literal notranslate"><span class="pre">false</span></code>.</p>
</div>
<div class="section" id="see-also">
<h2>See Also<a class="headerlink" href="#see-also" title="Permalink to this headline">¶</a></h2>
<p><a class="reference internal" href="mongoc_database_watch.html"><span class="doc">mongoc_database_watch()</span></a></p>
<p><a class="reference internal" href="mongoc_collection_watch.html"><span class="doc">mongoc_collection_watch()</span></a></p>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h3><a href="index.html">Table Of Contents</a></h3>
<ul>
<li class="toctree-l1"><a class="reference internal" href="installing.html">Installing the MongoDB C Driver (libmongoc) and BSON library (libbson)</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="tutorial.html">Tutorial</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="authentication.html">Authentication</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="basic-troubleshooting.html">Basic Troubleshooting</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="guides.html">Guides</a></li>
</ul>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="api.html">API Reference</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="init-cleanup.html">Initialization and cleanup</a></li>
<li class="toctree-l2"><a class="reference internal" href="logging.html">Logging</a></li>
<li class="toctree-l2"><a class="reference internal" href="errors.html">Error Reporting</a></li>
<li class="toctree-l2"><a class="reference internal" href="lifecycle.html">Object Lifecycle</a></li>
<li class="toctree-l2"><a class="reference internal" href="gridfs.html">GridFS</a></li>
<li class="toctree-l2"><a class="reference internal" href="mongoc_auto_encryption_opts_t.html">mongoc_auto_encryption_opts_t</a></li>
<li class="toctree-l2"><a class="reference internal" href="mongoc_bulk_operation_t.html">mongoc_bulk_operation_t</a></li>
<li class="toctree-l2"><a class="reference internal" href="mongoc_change_stream_t.html">mongoc_change_stream_t</a></li>
<li class="toctree-l2"><a class="reference internal" href="mongoc_client_encryption_t.html">mongoc_client_encryption_t</a></li>
<li class="toctree-l2"><a class="reference internal" href="mongoc_client_encryption_datakey_opts_t.html">mongoc_client_encryption_datakey_opts_t</a></li>
<li class="toctree-l2"><a class="reference internal" href="mongoc_client_encryption_encrypt_opts_t.html">mongoc_client_encryption_encrypt_opts_t</a></li>
<li class="toctree-l2"><a class="reference internal" href="mongoc_client_encryption_opts_t.html">mongoc_client_encryption_opts_t</a></li>
<li class="toctree-l2"><a class="reference internal" href="mongoc_client_pool_t.html">mongoc_client_pool_t</a></li>
<li class="toctree-l2"><a class="reference internal" href="mongoc_client_session_t.html">mongoc_client_session_t</a></li>
<li class="toctree-l2"><a class="reference internal" href="mongoc_client_session_with_transaction_cb_t.html">mongoc_client_session_with_transaction_cb_t</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="mongoc_client_t.html">mongoc_client_t</a></li>
<li class="toctree-l2"><a class="reference internal" href="mongoc_collection_t.html">mongoc_collection_t</a></li>
<li class="toctree-l2"><a class="reference internal" href="mongoc_cursor_t.html">mongoc_cursor_t</a></li>
<li class="toctree-l2"><a class="reference internal" href="mongoc_database_t.html">mongoc_database_t</a></li>
<li class="toctree-l2"><a class="reference internal" href="mongoc_delete_flags_t.html">mongoc_delete_flags_t</a></li>
<li class="toctree-l2"><a class="reference internal" href="mongoc_find_and_modify_opts_t.html">mongoc_find_and_modify_opts_t</a></li>
<li class="toctree-l2"><a class="reference internal" href="mongoc_gridfs_file_list_t.html">mongoc_gridfs_file_list_t</a></li>
<li class="toctree-l2"><a class="reference internal" href="mongoc_gridfs_file_opt_t.html">mongoc_gridfs_file_opt_t</a></li>
<li class="toctree-l2"><a class="reference internal" href="mongoc_gridfs_file_t.html">mongoc_gridfs_file_t</a></li>
<li class="toctree-l2"><a class="reference internal" href="mongoc_gridfs_bucket_t.html">mongoc_gridfs_bucket_t</a></li>
<li class="toctree-l2"><a class="reference internal" href="mongoc_gridfs_t.html">mongoc_gridfs_t</a></li>
<li class="toctree-l2"><a class="reference internal" href="mongoc_host_list_t.html">mongoc_host_list_t</a></li>
<li class="toctree-l2"><a class="reference internal" href="mongoc_index_opt_geo_t.html">mongoc_index_opt_geo_t</a></li>
<li class="toctree-l2"><a class="reference internal" href="mongoc_index_opt_t.html">mongoc_index_opt_t</a></li>
<li class="toctree-l2"><a class="reference internal" href="mongoc_index_opt_wt_t.html">mongoc_index_opt_wt_t</a></li>
<li class="toctree-l2"><a class="reference internal" href="mongoc_insert_flags_t.html">mongoc_insert_flags_t</a></li>
<li class="toctree-l2"><a class="reference internal" href="mongoc_iovec_t.html">mongoc_iovec_t</a></li>
<li class="toctree-l2"><a class="reference internal" href="mongoc_matcher_t.html">mongoc_matcher_t</a></li>
<li class="toctree-l2"><a class="reference internal" href="mongoc_query_flags_t.html">mongoc_query_flags_t</a></li>
<li class="toctree-l2"><a class="reference internal" href="mongoc_rand.html">mongoc_rand</a></li>
<li class="toctree-l2"><a class="reference internal" href="mongoc_read_concern_t.html">mongoc_read_concern_t</a></li>
<li class="toctree-l2"><a class="reference internal" href="mongoc_read_mode_t.html">mongoc_read_mode_t</a></li>
<li class="toctree-l2"><a class="reference internal" href="mongoc_read_prefs_t.html">mongoc_read_prefs_t</a></li>
<li class="toctree-l2"><a class="reference internal" href="mongoc_remove_flags_t.html">mongoc_remove_flags_t</a></li>
<li class="toctree-l2"><a class="reference internal" href="mongoc_reply_flags_t.html">mongoc_reply_flags_t</a></li>
<li class="toctree-l2"><a class="reference internal" href="mongoc_server_description_t.html">mongoc_server_description_t</a></li>
<li class="toctree-l2"><a class="reference internal" href="mongoc_session_opt_t.html">mongoc_session_opt_t</a></li>
<li class="toctree-l2"><a class="reference internal" href="mongoc_socket_t.html">mongoc_socket_t</a></li>
<li class="toctree-l2"><a class="reference internal" href="mongoc_ssl_opt_t.html">mongoc_ssl_opt_t</a></li>
<li class="toctree-l2"><a class="reference internal" href="mongoc_stream_buffered_t.html">mongoc_stream_buffered_t</a></li>
<li class="toctree-l2"><a class="reference internal" href="mongoc_stream_file_t.html">mongoc_stream_file_t</a></li>
<li class="toctree-l2"><a class="reference internal" href="mongoc_stream_socket_t.html">mongoc_stream_socket_t</a></li>
<li class="toctree-l2"><a class="reference internal" href="mongoc_stream_t.html">mongoc_stream_t</a></li>
<li class="toctree-l2"><a class="reference internal" href="mongoc_stream_tls_t.html">mongoc_stream_tls_t</a></li>
<li class="toctree-l2"><a class="reference internal" href="mongoc_topology_description_t.html">mongoc_topology_description_t</a></li>
<li class="toctree-l2"><a class="reference internal" href="mongoc_transaction_opt_t.html">mongoc_transaction_opt_t</a></li>
<li class="toctree-l2"><a class="reference internal" href="mongoc_transaction_state_t.html">mongoc_transaction_state_t</a></li>
<li class="toctree-l2"><a class="reference internal" href="mongoc_update_flags_t.html">mongoc_update_flags_t</a></li>
<li class="toctree-l2"><a class="reference internal" href="mongoc_uri_t.html">mongoc_uri_t</a></li>
<li class="toctree-l2"><a class="reference internal" href="mongoc_version.html">Version Checks</a></li>
<li class="toctree-l2"><a class="reference internal" href="mongoc_write_concern_t.html">mongoc_write_concern_t</a></li>
</ul>
</li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="application-performance-monitoring.html">Application Performance Monitoring (APM)</a></li>
</ul>
<!-- Because full_index.rst includes everything that index.rst includes, we have to exclude index.rst from the table-of-contents. This page is simply a link forced into the sidebar (in conf.py) to avoid including full_index.rst in the ToC. -->
<ul><li class='toctree-l1'><a href="full_index.html">Index</a></li></ul>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
  <div class="footer">
    &copy; Copyright 2017-present, MongoDB, Inc.
    Created using <a href="http://sphinx-doc.org/">Sphinx</a> 3.4.3.
  </div>
  
  </body>
</html>